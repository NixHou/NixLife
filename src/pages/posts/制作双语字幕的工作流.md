---
layout: '../../layouts/MarkdownPost.astro'
title: '制作双语字幕的工作流'
pubDate: 2023-04-17
description: '基于免费的商业或开源工具'
author: 'Nix Hou'
cover:
    url: 'https://cdn.staticaly.com/gh/NixHou/picx-images-hosting@master/20230417/FCP_MainUI.5qh9eguhgjy8.webp'
    square: 'https://cdn.staticaly.com/gh/NixHou/picx-images-hosting@master/20230417/FCP_MainUI.5qh9eguhgjy8.webp'
    alt: 'cover'
tags: ["工作流", "字幕", "Python", "FCPXML", "SRT"]
theme: 'light'
featured: true
---

最近遇到一个案例，要给客户提供的视频加上常规字幕。

在这类需求下，字节跳动旗下的视频剪辑软件[ 剪映 ](https://www.capcut.cn)目前被誉为是最好的「字幕制作」工具。得益于其**免费**的语音转文字功能，而且准确率也还不错，于是此前常用的[ 网易见外 ](https://sight.youdao.com)就被我喜新厌旧了…

![网易见外工作台的主要功能](https://cdn.staticaly.com/gh/NixHou/picx-images-hosting@master/20230417/Wangyijianwai_Function.7jb5ivlnh6gw.webp)

## 制作时间轴

过去主要依靠听力和音频波形，例如在[ ArcTime ](https://arctime.org)这样的字幕制作软件上进行手动打轴 (拖拽或 JK 键拍打)。当然，ArcTime 对于双语字幕的支持十分友好，可以参看官方使用教程：[双语字幕的制作流程 ](https://arctime.org/create-bilingual-subtitles.html)。

![Arctime 双语字幕的制作流程](https://cdn.staticaly.com/gh/NixHou/picx-images-hosting@master/20230417/Arctime_BilingualSubtitle_Tutorial.6f5lq0o5cfsw.webp)

我以前的工作流也是采用上述教程的方法。但我现在，则会先把视频扔进剪映，识别字幕，生成字幕轨道。然后参考客户提供的已审阅文本，将机器识别字幕中的额外分段，合并起来。检查一行字幕的「首」「尾」即可，此处不需要在意识别字幕的准确性，目的是获取「空轴」。主要是依托于文字的阅读效率高于听辨。

![剪映的软件界面，字幕功能有识别字幕和文稿匹配，以及导入本地字幕](https://cdn.staticaly.com/gh/NixHou/picx-images-hosting@master/20230417/Jianying_MainUI.5h40sg25ifb4.webp)

对于时长一两分钟的视频，阅读和听辨的差异其实不大，甚至你直接在剪辑软件上通过添加字幕的方式，一条条做也不会花费更多的时间。这里主要针对长视频，毕竟量级上去了，写个程序来辅助处理才会没那么焉用牛刀。

## 替换字幕文本

在你的检查下，获得了时间轴准确，但是文本不准确的字幕轨道。不用担心，从剪映中仅将字幕导出为 [SRT 文件](https://docs.fileformat.com/zh/video/srt/#srt-示例) 即可。

SRT 文件示例

```
1
00:01:00,000 --> 00:03:00,400
This is 1st subtitle.

2
00:05:10,400 --> 00:10:20,300
This is 2nd subtitle.
```

那么，就到了替换文本的时刻。一行行复制粘贴吗？不。既然是某种重复的电子劳动，那自然要问问伟大的 ChatGPT 了。

于是你获得了以下代码：

```python
import pysrt

# 定义输入文件路径
srt_file_path = 'path/to/your/srt/file.srt'
txt_file_path = 'path/to/your/txt/file.txt'

# 定义输出文件路径
new_srt_file_path = 'path/to/your/new/srt/file.srt'

# 读取 txt 文件中的文本
with open(txt_file_path, 'r', encoding='utf-8') as txt_file:
    replacement_content = txt_file.read()

# 将 txt 文件分割为句子列表
replacement_text = replacement_content.split('\n')

# 使用 pysrt 库加载 SRT 文件
subs = pysrt.open(srt_file_path)

# 遍历每个字幕条目，将文本替换为 txt 文件中的文本
for id, sub in enumerate(subs):
    sub.text = replacement_text[id]

# 将修改后的字幕保存到新的 SRT 文件中
subs.save(new_srt_file_path, encoding='utf-8')    

print("字幕替换完成！")

"""
请确保已经安装了 pysrt 库，您可以使用 pip 命令来安装它：pip install pysrt。
同时，请将 srt_file_path、txt_file_path 和 new_srt_file_path 替换为您实际的文件路径。
这段代码会将 SRT 文件中的所有字幕文本替换为 txt 文件中的文本，并将修改后的字幕保存到新的 SRT 文件中。
"""
```

它真的，很暖心。

发散了，回归正题。运行以上代码后，你应该可以获得两个 SRT 文件。它们的时间轴和字幕文本都应该是完全正确的了。

如果你的双语文本是中英文交替出现的，则可以参考以下代码：

```python
# 打开文件并读取内容
with open('bilingual.txt', 'r', encoding='utf-8') as f:
    lines = f.readlines()

# 初始化中英文列表
chinese_sentences = []
english_sentences = []

# 分别提取中英文句子
for i in range(len(lines)):
    if i % 2 == 0:  # 偶数行为中文句子
        chinese_sentences.append(lines[i].strip())  # 去除换行符并添加到中文列表
    else:  # 奇数行为英文句子
        english_sentences.append(lines[i].strip())  # 去除换行符并添加到英文列表

# 打印中英文列表
print("中文句子列表：", chinese_sentences)
print("英文句子列表：", english_sentences)

"""
以上代码将会把 bilingual.txt 文件中的中英文句子分别保存
到 chinese_sentences 和 english_sentences 两个列表中，
并在最后打印输出这两个列表。

注意，这里假设中英文句子的顺序是交替出现的，即偶数行为中文，奇数行为英文。
如果文本文件中的格式不是严格的交替句子，需要根据实际情况进行适当的调整。
"""
```

## 导入至剪辑软件

**剪映**：支持导入 SRT 字幕。导入后，编辑样式，导出视频，交付。

**Final Cut Pro**：支持导入 SRT 字幕（大笑。可以说，很少会有人真的在用这个选项吧。更多的选择是通过 XML 来导入字幕。那么就涉及到 SRT 文件如何转为 [FCPXML 文件](https://support.apple.com/zh-cn/guide/final-cut-pro/verdbd66ae/10.6.2/mac/11.5.1)。

FCPXML 文件示例

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE fcpxml>

<fcpxml version="1.10">
    <resources>
        <format id="r1" name="FFVideoFormat1080p2997" frameDuration="1001/30000s" width="1920" height="1080" colorSpace="1-1-1 (Rec. 709)"/>
        <effect id="r2" name="基本字幕" uid=".../Titles.localized/Bumper:Opener.localized/Basic Title.localized/Basic Title.moti"/>
    </resources>
    <library>
        <event name="{EVENT_NAME}">
            <project name="{PROJECT_NAME}">
                <sequence format="r1" tcStart="0s" tcFormat="NDF">
                    <spine>
                        <title ref="r2" name="{TITLE_NO}" offset="{OFFSET}" duration="{DURATION}" start="{START}">
                            <param name="展平" key="9999/999166631/999166633/2/351" value="1"/>
                            <param name="对齐" key="9999/999166631/999166633/2/354/999169573/401" value="1 (居中)"/>
                            <text>
                                <text-style ref="ts1">{TEXT}</text-style>
                            </text>
                            <text-style-def id="ts1">
                                <text-style font="Noto Sans SC" fontSize="42" fontFace="Regular" fontColor="1 1 1 1" shadowColor="0 0 0 0.75" shadowOffset="5 315" shadowBlurRadius="4"/>
                            </text-style-def>
                            <adjust-transform position="0 -40.7407"/>
                        </title>
                    </spine>
                </sequence>
            </project>
        </event>
    </library>
</fcpxml>
```

我问了 ChatGPT，给出的框架是对的，但运行的结果无法通过 Final Cut Pro 的[ DTD 验证](https://developer.apple.com/documentation/professional_video_applications/fcpxml_reference/document_type_definition)。尽管我把报错信息也喂给了 ChatGPT，它也只是不断地向我抱歉，终究无果。不怪它，大概是我的 Prompt 水平太低。

于是问了 Google，找到了一个在线转换的工具，[crossub 字幕转换工具](https://crossub.xiaowude.com)。

但是我会更想要基于本地的方案，就去 GitHub 上寻觅了一下，找到了这个项目[ hysmichael/srt_fcpxml_converter ](https://github.com/hysmichael/srt_fcpxml_converter)。与其他项目不同的是，这个作者实现了 SRT 与 FCPXML 之间的互相转换，这意味着我之前在 Final Cut Pro 内做的字幕，都可以导出为 SRT 文件保存了。此乃神器！

![从 SRT 转换为 FCPXML 文件，并导入 Final Cut Pro](https://cdn.staticaly.com/gh/NixHou/picx-images-hosting@master/20230417/FCP_MainUI.5qh9eguhgjy8.webp)